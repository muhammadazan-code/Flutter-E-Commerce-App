(self["webpackChunk_canva_web"] = self["webpackChunk_canva_web"] || []).push([[18061],{

/***/ 779153:
function(_, __, __webpack_require__) {__webpack_require__.n_x = __webpack_require__.n;const __web_req__ = __webpack_require__;__web_req__(905716);__web_req__(764820);__web_req__(881860);__web_req__(715130);__web_req__(638993);__web_req__(918208);__web_req__(659921);__web_req__(901006);__web_req__(184626);__web_req__(487513);__web_req__(423901);__web_req__(744862);__web_req__(428852);__web_req__(596972);__web_req__(499685);__web_req__(804092);__web_req__(413311);__web_req__(420124);__web_req__(361753);__web_req__(394647);__web_req__(804077);__web_req__(100191);__web_req__(268284);self._456c437108d2d2713799e19380be528d = self._456c437108d2d2713799e19380be528d || {};(function(__c) {var aLf=__c.aLf;var JNg;var eGl=__c.eGl;var M=__c.M;var ld=__c.ld;var INg=__c.INg;var m=__c.m;var ra=__c.ra;var dNg=__c.dNg;var J=__c.J;
var AL=function(a,b){return a.$2d.get(b)||[]},KGl=async function(a){try{const b=await __c.bh(a.slice(0,__c.Llj)),c=new DataView(b),d=c.getUint32(0,!0),e=c.getUint16(4,!0);return d===IGl&&e>=JGl}catch{return!1}},LGl=async function(a){if(a.size<3)return!1;a=await __c.bh(a.slice(0,3));a=new DataView(a);return a.getUint8(0)===73&&a.getUint8(1)===68&&a.getUint8(2)===51||a.getUint8(0)===255&&a.getUint8(1)>=224&&a.getUint8(1)<=255},MGl=async function(a){if(a.size<8)return!1;a=await __c.bh(a.slice(0,8));
a=new DataView(a);return a.getUint8(0)===79&&a.getUint8(1)===103&&a.getUint8(2)===103&&a.getUint8(3)===83&&a.getUint8(4)===0&&a.getUint8(5)===2&&a.getUint8(6)===0&&a.getUint8(7)===0},NGl=async function(a){if(a.size<12)return!1;a=await __c.bh(a.slice(0,12));var b=new DataView(a);a=b.getUint8(0)===82&&b.getUint8(1)===73&&b.getUint8(2)===70&&b.getUint8(3)===70;b=b.getUint8(8)===87&&b.getUint8(9)===65&&b.getUint8(10)===86&&b.getUint8(11)===69;return a&&b},OGl=function(a){return{pending:a.filter(({status:b})=>
b==="pending").map(({id:b})=>b),j0:a.filter(({status:b})=>b==="failure").map(({id:b})=>b),unknown:a.filter(({status:b})=>b==="unknown").map(({id:b})=>b),success:a.filter(({status:b})=>b==="success").map(({id:b})=>b)}},PGl=function(a,b,c,d,{Pot:e=36E5,lPr:f=6E4,IXq:g=10,Sb:h=__c.Tb}={}){function k(v,w){v.forEach(x=>{if(x=l.get(x))x.error=w})}const l=new Map;let n=[],p=[];a.forEach(v=>{const w=b(v);n.push(w);p.push({id:w,status:"pending"});l.set(w,v)});let q=0;const r=h.now(),t=async()=>{try{p=await c(n)}catch(y){if(y instanceof
__c.rh){k(n,new __c.a8e);return}}const {pending:v,j0:w,unknown:x}=OGl(p);v.length>0?h.now()-r>=e?k(v,new __c.b8e):(++q,setTimeout(t,g&&q<=g?2E3:Math.min(Math.pow(2,q-g)*1E3,f))):w.length>0?k(w,new __c.c8e):x.length>0&&k(x,new __c.d8e);p.forEach(({id:y,status:z})=>{(y=l.get(y))&&d(y,z)});n=v};t()},QGl=function(a,b){b.forEach(c=>{if(a[c]==null)throw 13;})},SGl=function(a){a&&a.length!==0&&a.forEach(b=>{QGl(b,RGl);const c=b.ty;if(c==="sr")throw 10;if(c==="gs")throw 11;c==="gr"&&SGl(b.it)})},UGl=function(a){a&&
a.forEach(b=>{QGl(b,TGl);if(b.ddd)throw 4;var c=b.sr;if(c&&c!==1)throw 5;if((c=b.tm)&&c!==1)throw 15;c=b.ty;if(c===1)throw 6;if(c===2)throw 7;if(c===6)throw 8;if(c===5)throw 9;b.ty===4&&SGl(b.shapes)})},VGl=function(a){(a=a.assets)&&a.forEach(b=>{if(__c.EWf(b))UGl(b.layers);else throw 12;})},WGl=function(a){return typeof a==="object"&&!Array.isArray(a)&&a!=null},XGl=async function(a,b){try{if(a.size>b)throw 0;if(a.type!=="application/json")throw 1;let c;try{const d=await __c.z1c(a);c=JSON.parse(d)}catch(d){throw 2;
}if(!WGl(c))throw 3;return{parsed:!0,wJr:c}}catch(c){return{parsed:!1,A_n:[0,1,2,3,4].includes(c)?c:4}}},YGl=function(a,b){WGl(a)?Object.entries(a).forEach(([c,d])=>{b(c,d);YGl(d,b)}):Array.isArray(a)&&a.forEach(c=>{YGl(c,b)})},ZGl=function(a){YGl(a,(b,c)=>{if(b==="x"&&typeof c==="string")throw 2;})},$Gl=function(a,b,c){return b?.scd?.get(a)||b?.Qyb||c},aHl=async function(a){switch(a.type){case "image/gif":return await __c.Klj.QDf(a.content)?2:4;case "application/json":return 3;default:return 1}},
cHl=function(a,b,c){return async d=>{var e=d.type.split(";")[0];if(e==="application/json"){var f=$Gl(e,a);f=await XGl(d.content,f);if(!f.parsed)switch(f.A_n){case 0:return 4;case 1:return 0;case 2:case 3:case 4:return 3;default:throw new __c.u(f.A_n);}d=$Gl(e,b);e=$Gl(e,c);if(d&&e){f=f.wJr;d=Math.max(d.height||0,d.width||0);try{QGl(f,bHl);const h=f.h;if(f.w>d||h>d)throw 0;if((f.op-f.ip)/f.fr>e/1E3)throw 1;if(f.ddd)throw 4;const k=f.fonts?.list;if(k&&k.length!==0)throw 3;ZGl(f);VGl(f);UGl(f.layers);
var g={valid:!0}}catch(h){g={valid:!1,iBa:[0,1,2,3,4,5,15,6,7,8,9,10,11,12,13,14].includes(h)?h:14}}if(!g.valid)switch(g.iBa){case 0:return 5;case 1:return 6;case 13:case 14:return 3;case 2:case 3:case 4:case 5:case 15:case 6:case 7:case 8:case 9:case 10:case 11:case 12:return 7;default:throw new __c.u(g.iBa);}}}}},dHl=function(a){return async b=>{var c=b.type.split(";")[0];c=a.scd?.get(c)||a.Qyb;if(b.content.size>c)return 1}},eHl=function(a){return async b=>{b=b.type.split(";")[0];if(!a.includes(b))return 0}},
fHl=function(a){return async b=>{if(!b.content.size||!a&&({valid:b}=await __c.tmj(b),!b))return 3}},gHl=function(a){return a?a.type==="library"?"library":a.Xh&&a.Xh.type===1?"unfoldered_uploads":"normal":"virtual_uploads"},hHl=function(a){return a.map(b=>b.type).join(",")},iHl=function(a){return a.reduce((b,c)=>c.content.size+b,0)},lHl=function({Ue:a}){const b=a.length>4?a.slice(0,3):a;return jHl(__c.uC,{children:[b.map((c,d)=>BL(__c.vC,{children:BL(__c.Tc,{spacing:"0",children:BL(__c.fr,{tagName:"span",
children:c})})},d)),BL(kHl,{$Zr:a.length-b.length})]})},kHl=function({$Zr:a}){return a>0?BL(__c.vC,{children:J("r1sTcA",[a])}):null},mHl=function(){var a=__c.tx(__c.qi(__c.Dt.mtj));a=J("bFN9hA",[a]);return BL(__c.Q,{margins:"legacy",children:BL(__c.Zj,{message:a})})},nHl=function({Dac:a,qFb:b}){return BL(__c.Q,{margins:"legacy",children:BL(__c.Zj,{message:J("r0lNVg",[b,a])})})},oHl=function(a,b){return new __c.xB({...a,metadata:a.metadata&&new __c.yB({...a.metadata,rr:b||a.metadata.rr,ROa:b||a.metadata.ROa})})},
qHl=async function(a,b,c,d,e){e.Il("file_upload_started");const f=CL(g=>{g.lengthComputable?b.Hmb(g.loaded/g.total):b.l4()});try{await a.vs.upload({file:c,url:d.D5,OV:d.params,Jka:f}),e.Il("file_upload_finished"),await pHl(a,b,e)}catch(g){e.finish({success:!1}),a.errorService?.error(g),b.error=new dNg(g,g instanceof __c.omd?g.httpStatusCode:void 0)}return b.finished},pHl=async function(a,b,c){try{const {audio:d}=await a.Mr.Fli(new __c.Wlj({id:b.audio.id})),e=oHl(d,b.audio.metadata?.rr);b.l4(e);a.poll(b)}catch(d){c.finish({success:!1}),
a.errorService?.error(d),b.error=new __c.d8e(d)}},sHl=function(a){rHl(()=>a.finished=new Promise(b=>a.resolve=b))},tHl=async function(a,b,c,d,e,f,g){ra(a.QKa!=null);f?.Il("file_upload_started");d=new __c.EGl({mimeType:b.type,HOq:__c.cGl(b.name),GSf:d,Zqi:g});g=CL(h=>{h.lengthComputable?c.Hmb(h.loaded/h.total):c.l4()});try{const {id:h}=await a.QKa.upload({file:b,backend:"designimport",strategy:0,metadata:d,Jka:g,va:e});f?.Il("file_upload_finished");f?.Il("resource_created");c.asq=h;a.poll(c,e)}catch(h){f?.finish({success:!1}),
c.error=new dNg(h,h instanceof __c.QFl?h.httpStatusCode:void 0)}return c.finished},uHl=function(a,b){a.Oy=b},vHl=async function(a,b){let c=a.vzf.get(b);c||(c=a.Zd.rN(new __c.Tgk({Ba:b})),a.vzf.set(b,c));try{const {Ba:d}=await c;return d.defaultView!==3}catch{return!0}},wHl=function(a,b,c){c=new __c.Ss(c?.type==="folder"?c:{id:c?.id});if(c.Xh)a.Zd.qqf(new __c.XFl({e4c:!0,brand:c.Xh.brand,user:m(c.Xh.user,"System folder must have a user attribute"),type:__c.Tgj(c.Xh.type),body:new __c.WFl({Ba:c,item:new __c.$s({id:b.id,
type:6})})}));else{var d=m(c.id,"Empty folder id, and not a system folder");a.Zd.JAe({e4c:!0,Ba:d,body:new __c.WFl({Ba:c,item:new __c.$s({id:b.id,type:6})})})}},xHl=async function(a,b,c,d,e,f){e.Il("file_upload_started");const g=[],h=CL((k,l)=>{if(!k.lengthComputable)return b.l4();g[l].yC=k.loaded/k.total;k=g.reduce((n,{D7c:p,yC:q})=>n+q*p,0);b.Hmb(Math.min(k,1))});d=d.Hfc.map(async(k,l)=>{var n=b.XOj.has(k.rbl);const p=k.Cnm+1;g.push({D7c:Math.min((p-k.SHj)/c.content.size,1),yC:n?1:0});n||(n=await a.vs.gbj({file:{name:c.name,
type:c.type,content:c.content.slice(k.SHj,p,c.type)},url:k.D5,Jka:q=>h(q,l),dpl:"etag"}),b.XOj.set(k.rbl,n))});try{await Promise.all(d),e.Il("file_upload_finished"),await a.Cg.pbb(new __c.USj({id:b.video.id,v2g:!0,Hfc:b.XOj}),{va:void 0})}catch(k){e.finish({success:!1});a.errorService?.error(k);b.error=new dNg(k,k instanceof __c.omd?k.httpStatusCode:void 0);return}a.poll(b,f);return b.finished},yHl=async function(a,b,c,d,e,f){e.Il("file_upload_started");const g=CL(h=>{h.lengthComputable?b.Hmb(h.loaded/
h.total):b.l4()});try{await a.vs.upload({file:c,url:d.D5,OV:d.params,Jka:g}),e.Il("file_upload_finished"),await a.Cg.pbb(new __c.USj({id:b.video.id}),{va:f})}catch(h){e.finish({success:!1});b.error=new dNg(h,h instanceof __c.omd?h.httpStatusCode:void 0);return}a.poll(b,f);return b.finished},zHl=async function(a){try{switch(a.type.split(";")[0]){case "audio/mp3":case "audio/mpeg":return{file:a,valid:await LGl(a.content)||await __c.imj(a.content)};case "audio/webm":return{valid:!0,file:a};case "audio/x-wav":case "audio/wav":return{valid:await NGl(a.content),
file:a};case "audio/x-m4a":case "audio/mp4":return{valid:await __c.imj(a.content),file:a};case "audio/ogg":return{valid:await MGl(a.content),file:a};default:return{valid:!1,file:a}}}catch{return{valid:!1,file:a}}},CHl=function(a,{Qjb:b,hqa:c}){const d=AHl(()=>a.upload.error,f=>{f&&(f={...a,error:f},b&&b(f))}),e=BHl(()=>{a.upload.finished.then(()=>{a.upload.error==null&&(e(),d(),c&&c(a))})})},DHl=function(a,b){const c=BHl(()=>{b.finished.then(()=>{b.HM.some(d=>d.error!=null)||(c(),a.$p?.dNb(),a.$p?.ngh(b))})})},
EHl=async function(a,b,c){var d=a.V0g.Qyb;d=a.V0g.scd.get(b.type)??d;if(a.D7m.includes(b.type)){if(!b.content.size)return 3;if(b.content.size>d)return 1}else return 0;try{switch(b.type){case "application/affinity":if(await KGl(b.content)){const e=(await c).ZUe;if(e==null)return 9;if(a.EAn!=null&&e>a.EAn)return 8;break}return 3;default:return 3}}catch(e){return e instanceof __c.Rlj?9:3}},GHl=function(a,b,c){return FHl(()=>a.status===2&&c?c:b)},IGl=1095499520,JGl=7,HHl=class{gGc(a){return this.mwa.includes(a)}async fCc(a){return __c.qmj(a,
this.mwa,this.V0g,this.utf)}async rFa(a,b){ra(a.length>0,"Nothing to upload");const {Wvi:c}=b.yt?.("media")??{};if(a.some(f=>f.Kt!==!1)&&this.$p&&!await this.$p.mYb())throw new __c.e0h;var d=new INg;const e=await __c.smj(a,this.mwa,this.V0g,this.utf,d);a=e.filter(({valid:f})=>f).map(({file:f})=>f);b.ySc?.({files:a,K8:d});d=a.map(async f=>{const g=e.findIndex(k=>k.file===f);let h=!0;try{const k=await this.bwb.run(()=>this.Xmc(f,g,c,b)),l=this.bwb.run(()=>this.FLc(k));return{type:"media",upload:k,finished:l}}catch(k){throw h=
!1,k;}finally{b.U8g?.({type:"media",file:f,success:h})}});return Promise.all(d)}async Xmc(a,b,c,d){const e=d.Wza,f=d.K6,g=d.HJ,h=await this.LVb(a.type).handle(a.content);a.content=h.file;const k=await this.Imb.get().E2(a,{media:a.media,Kt:a.Kt,va:c,K6:f,aVe:a.aVe,Cab:a.Cab,H9a:a.H9a,HJ:g});c=await this.Gyg(h.img,800,800,a.type);const l=__c.pmj(c);(0,__c.wmj)(()=>{k.media={...k.media,Qb:{...k.media.Qb,dimensions:{width:h.img.naturalWidth,height:h.img.naturalHeight},files:[...k.media.Qb.files,l]}}});
b={type:"media",upload:k,j9e:d.Pnb,file:a,index:b,K6:d.K6,Kk:[h.img],width:h.img.naturalWidth,height:h.img.naturalHeight,GE:[k.media.id],HJ:g};e&&e(b);this.eNd(a,b,d);this.$p?.cig(k,h.file.size);return k}async FLc(a){a.start();await a.finished;return a}eNd(a,b,{Qjb:c,hqa:d}){const e=(0,__c.xmj)(()=>b.upload.error,g=>{g&&(a.KUn&&a.KUn(b),g={...b,error:g},c&&c(g))}),f=(0,__c.vmj)(()=>{b.upload.finished.then(()=>{b.upload.error==null&&(f(),e(),this.$p?.dNb(),this.$p?.ngh(b.upload),a.hqa&&a.hqa(b),d&&
d(b))})})}constructor(a,b,c,d,e,f){var g=__c.dH.Mob;this.Imb=a;this.bwb=b;this.$p=c;this.mwa=d;this.V0g=e;this.utf=f;this.LVb=g;this.Gyg=__c.iWg}},bHl="w h fr layers op ip".split(" "),TGl=["ty","st","ip","op"],RGl=["ty"],IHl=class extends Error{},JHl=class{gGc(a){return!!this.aja.find(b=>a.includes(b))}async rFa(a,b){ra(a.length>0,"Nothing to upload");const {Wvi:c}=b.yt?.("video")??{};if(!await this.$p.mYb())throw new __c.e0h;var d=new INg;const e=await this.HFg(a,d);b.ySc?.({files:[],K8:d});let f;
const g=[],h=[],k=[],l=[],n=[];d=e.map(async p=>{let q=!0;try{const r=await this.bwb.run(()=>this.Xmc(p,a.indexOf(p),c,b));l.push(r);n.push(this.Oak(r));g.push(p)}catch(r){q=!1,r instanceof IHl?h.push(p):r instanceof __c.j0h?k.push(p):(g.push(p),f=r)}finally{b.U8g?.({type:"video",file:p,success:q})}});await Promise.allSettled(d);d=new INg;d.rEc(3,...h);d.rEc(2,...k);b.ySc?.({files:g,K8:d});if(f)throw f;return l.map((p,q)=>({type:"video",upload:p,finished:n[q]}))}Oak(a){return this.bwb.run(()=>this.FLc(a))}async Xmc(a,
b,c,d){const e=d.Wza,f=d.K6,g=d.HJ;let h;try{h=await this.LVb(a.type).handle(a.content),a.content=h.file}catch(v){throw new IHl;}const k=h.img,l=h.Bck,n=h.width||1,p=h.height||1,q=await this.vmd.get().E2(a,{width:n,height:p,va:c,duration:h.duration,contentType:await aHl(a),DQq:a.U9h,K6:f,HJ:g});let r;switch(q.video.contentType){case "VIDEO":r=1;break;case "VECTOR_STICKER":r=4;break;default:r=2}const t=!l&&this.url.createObjectURL(h.file);(0,__c.wmj)(()=>{q.video={...q.video,...(t&&{WG:[new __c.Ch({width:n,
height:p,container:r,url:t})],oR:[new __c.Ch({width:n,height:p,container:r,url:t})]}),rB:k.src?[new __c.Ah({url:k.src,width:n,height:p})]:[]};this.$p.cig(q,a.content.size)});b={type:"video",upload:q,j9e:d.Pnb,file:a,index:b,K6:f,Kk:[],width:h.width,height:h.height,duration:h.duration,GE:[q.video.id],HJ:g};e&&e(b);this.eNd(b,d);return q}async FLc(a){a.start();await a.finished;return a}eNd(a,{hqa:b,Qjb:c}){const d=a.upload,e=(0,__c.xmj)(()=>d.error,g=>{g&&(g={...a,error:g},c&&c(g))}),f=(0,__c.xmj)(()=>
d.finished,g=>{g.then(()=>{d.error==null&&(f(),e(),this.$p.dNb(),this.$p.ngh(d),b&&b(a))})},{fireImmediately:!0})}async HFg(a,b){const c=await Promise.all(a.map(d=>this.fCc(d)));return a.reduce((d,e,f)=>{f=c[f];f===void 0?d.push(e):b.rEc(f,e);return d},[])}async fCc(a){for(const b of this.bkc){const c=await b(a);if(c!==void 0)return c}}constructor(a,b,c,d,e,f,g,h){var k=__c.dH.Mob,l=URL;this.vmd=a;this.bwb=b;this.$p=c;this.aja=d;this.jXo=e;this.lst=f;this.jst=g;this.utf=h;this.LVb=k;this.url=l;this.bkc=
[eHl(this.aja),cHl(this.jXo,this.lst,this.jst),dHl(this.jXo),fHl(this.utf)]}},KHl=({onClose:a})=>(0,__c.zL)(ld,{title:M("+ASFfA"),explanation:M("652EuQ"),button:{children:M("SrXzQw"),onClick:a}}),LHl=({onClose:a,YQk:b})=>(0,__c.zL)(ld,{title:M("5dDPYA"),explanation:J("Os3xHA",[b]),button:{children:M("SrXzQw"),onClick:a}}),MHl=({onClose:a})=>(0,__c.zL)(ld,{title:M("fesNZw"),explanation:M("lMmO9A"),button:{children:M("SrXzQw"),onClick:a}}),NHl=__webpack_require__(31968),OHl=NHl.Fragment,BL=NHl.jsx,
jHl=NHl.jsxs;var DL=__webpack_require__(647370).PA;var PHl=__webpack_require__(845212).useCallback;var QHl=__webpack_require__(186901),FHl=QHl.EW,BHl=QHl.fm,rHl=QHl.h5,AHl=QHl.mJ,RHl=QHl.sH,CL=QHl.XI;var SHl=__webpack_require__,THl=SHl(105572),UHl=SHl.n_x(THl)();var VHl={eventType:"resource_uploaded",Oa(a){return __c.jf({source:a.source,component:a.component,control_context:a.mb,filenames:a.bXm,file_extensions:a.MUq,mime_types:a.mimeTypes,file_size:a.fileSize,storage_type:a.pXc,resource_quantity:a.whe,offline_timestamp:a.yRc,upload_id:a.pxa,design_id:a.designId,doctype_id:a.Ea,category_id:a.eb,upload_succeeded:a.Reb,failure_reason:a.Vn,folder:a.Ba,folder_id:a.Dd,marketplace_page_id:a.$bd,marketplace_session_id:a.acd,is_item_in_folder_upload:a.HJ})}},WHl=
{eventType:"upload_finished",Oa(a){return __c.jf({source:a.source,component:a.component,control_context:a.mb,upload_succeeded:a.Reb,time_elapsed_ms:a.Fvb,mime_types_failed_to_upload:a.x1g,mime_types_uploaded:a.y1g,bytes_failed_to_upload:a.pSt,bytes_uploaded:a.qSt,file_upload_contexts:a.zek?.map(b=>__c.jf({upload_succeeded:b.Reb,upload_type:b.uploadType,mime_type:b.mimeType,file_size:b.fileSize,width:b.width,height:b.height,duration:b.duration,time_elapsed_ms:b.Fvb,initialization_duration_ms:b.ZAk,
file_upload_duration_ms:b.Aek,import_duration_ms:b.dzk,resource_ids:b.GE,failure_reasons:b.Xxf,uploaded_chunk_sizes_bytes:b.yAh,chunk_upload_failure_reasons:b.ipg,is_item_in_folder_upload:b.HJ})),offline_timestamp:a.yRc,upload_id:a.pxa,design_id:a.designId,doctype_id:a.Ea,category_id:a.eb,resource_ids:a.GE,folder:a.Ba,folder_id:a.Dd,marketplace_page_id:a.$bd,marketplace_session_id:a.acd})}},XHl={eventType:"folder_uploaded",Oa(a){return __c.jf({upload_id:a.pxa,source:a.source,page:a.page,location:a.location,
control_context:a.mb,location_folder_id:a.hAu,upload_folder_id:a.Iot,num_subfolders:a.nBi,max_folder_depth:a.QQk,num_items:a.vjb,upload_status:a.xAh,failure_reason:a.Vn})}};var YHl=class{C9i({files:a,component:b,mb:c,Vn:d,pXc:e,yRc:f,pxa:g,K6:h,$bd:k,acd:l,HJ:n}){const p=a.map(q=>q.name.includes(".")?q.name.slice(q.name.lastIndexOf(".")):"").join(",");this.P.track(VHl,{source:this.properties.source,component:b,mb:c,pxa:g,mimeTypes:hHl(a),MUq:p,fileSize:iHl(a),whe:a.length,pXc:e,yRc:f?.toISOString(),Reb:!d,Ba:gHl(h),Dd:h?.id,Vn:d,$bd:k,acd:l,HJ:n})}wne({Reb:a,Fvb:b,zek:c,component:d,mb:e,yRc:f,pxa:g,K6:h,$bd:k,acd:l}){this.P.track(WHl,{source:this.properties.source,component:d,
mb:e,pxa:g,Reb:a,Fvb:b,zek:c,yRc:f?.toISOString(),Ba:gHl(h),Dd:h?.id,$bd:k,acd:l})}aRl({pK:a,pxa:b}){let c;switch(this.properties.source){case "home":c="home";break;case "object_panel":c="editor";break;default:this.errorService.error(`Received unsupported '${this.properties.source}' source value for FolderCreated analytics event`)}this.P.track(__c.ghk,{source:c,pK:a,fG:"mixed",location:"folder_upload",pxa:b})}h9i(a){let b;switch(this.properties.source){case "home":b="home";break;case "object_panel":b=
"editor";break;default:this.errorService.error(`Received unsupported '${this.properties.source}' source value for FolderUploaded analytics event`)}this.P.track(XHl,{source:b,...a})}constructor(a,b,c){this.P=a;this.errorService=b;this.properties=c;this.source=c.source}};var ZHl=DL(function({onClose:a,Ba:b}){return BL(ld,{title:M("dDN47w"),explanation:J("NlYz8g",[b.Xpa,b.Xpa-b.numberOfItems]),button:{children:M("UGbdSw"),onClick:a}})}),$Hl=DL(function({onClose:a}){return BL(ld,{title:M("cDqNzQ"),explanation:M("Suj92w"),button:{children:M("UGbdSw"),onClick:a}})});var aIl=DL(function({onClose:a,Ue:b,Dac:c,qFb:d}){c=jHl(OHl,{children:[BL(nHl,{Dac:c,qFb:d}),BL(__c.jd,{size:"1u"}),BL(lHl,{Ue:b}),BL(__c.jd,{size:"2u"}),BL(mHl,{})]});return BL(ld,{title:J("iws9sQ",[b.length]),explanation:b.length&&c,button:{children:M("UGbdSw"),onClick:a}})});var bIl=class{gGc(a){const b=this.pMf.gGc(a)||this.SBh?.gGc(a)||!1;return a==="image/gif"&&b}async fCc(a){if(!await this.isValid(a.content))return 3;const b=this.pMf,c=this.SBh,d=await __c.Klj.p8d(a.content);if(d&&!c?.gGc(a.type)||!d&&!b?.gGc(a.type))return 3}async rFa(a,b){const c=this.pMf,d=this.SBh,e=[],f=[],g=new INg;for(const l of a)a=await this.fCc(l),a!==void 0?g.rEc(a,l):await __c.Klj.p8d(l.content)?f.push(l):e.push(l);g.hasError&&b.ySc?.({files:[],K8:g});const [h,k]=await Promise.all([f.length&&
d?d.rFa(f,b):[],e.length?c.rFa(e,b):[]]);return[...h,...k]}async isValid(a){a=await __c.y1c(a);try{return await this.uR(a),!0}catch{return!1}}constructor(a,b,c=__c.Ds){this.pMf=a;this.SBh=b;this.uR=c}};var eIl=class{static G(a){__c.O(a,{audio:RHl.ref,progress:RHl.ref,_error:RHl.ref,finished:RHl.ref,l4:CL})}YUc(){this.finished=new Promise(a=>{this.resolve=a})}Hmb(a){ra(a>=0&&a<=1);this.Jcb==null&&(this.Jcb=this.progress);this.progress=this.Jcb+(1-this.Jcb)*cIl*a}l4(a){this.progress+=Math.random()*dIl*(1-this.progress);a&&(this.audio=a)}get error(){return this._error}set error(a){rHl(()=>this._error=a);this.resolve()}start(){return this.ZX.upload(this)}finish(a){this.progress=1;this.audio=a;this.resolve()}constructor(a,
b,c){this.ZX=b;this.Jcb=(eIl.G(this),void 0);this.progress=0;this._error=void 0;this.audio=a;this.YUc();this.metrics=c?.metrics;this.HJ=c?.HJ}},cIl=.8,dIl=.1;var fIl=class{async E2(a,b){const c=this.OUj(),{audio:d,m2a:e}=b?.yQq??await this.lAe(a,c),f=oHl(d,b?.duration);let g;if(this.QKa!=null){const h=this.QKa;g=k=>this.OWl(k,h,f,a,c)}else g=h=>qHl(this,h,a,e,c);b=new eIl(f,{upload:g},{metrics:c,HJ:b?.HJ});b.l4();c.Il("initialization_finished");return b}async lAe(a,b){try{const {audio:c,m2a:d}=await this.Mr.lAe(new __c.iPg({filename:a.name,Bo:!0,brand:this.X.Ab.brand.id,user:this.X.user.id}));b.Il("resource_created");ra(d!=null,"Cannot upload audio for already existing file");
return{audio:c,m2a:d}}catch(c){throw b.finish({success:!1}),this.errorService?.error(c),c;}}async OWl(a,b,c,d,e){e.Il("file_upload_started");const f=CL(h=>{h.lengthComputable?a.Hmb(h.loaded/h.total):a.l4()}),g=new __c.DGl({audioId:c.id,mimeType:d.type});try{await b.upload({backend:"audio",file:d,strategy:0,metadata:g,Jka:f}),e.Il("file_upload_finished"),a.l4(c),this.poll(a)}catch(h){e.finish({success:!1}),this.errorService?.error(h),a.error=new dNg(h,h instanceof __c.QFl?h.httpStatusCode:void 0)}return a.finished}poll(a){const b=
new __c.QIe({id:a.audio.id,sCb:!0});let c=a.audio;const d=a.metrics;__c.e8e(a,async()=>{({audio:c}=await this.Mr.Uab(b));return c.Pw?"unknown":c.status==="UPLOADING"||c.status==="PROCESSING"?"pending":c.status==="FAILED"?(d?.finish({success:!1}),"failure"):c.status==="IMPORTED"?(d?.finish({success:!0}),"success"):"unknown"},CL(e=>{e==="pending"?(e=oHl(c,a.audio.metadata?.rr),a.l4(e)):e==="success"&&a.finish(c)}),{Sb:this.Sb})}constructor(a,b,c,d,e){this.X=a;this.Mr=b;this.vs=c;this.QKa=d;this.errorService=
e;this.OUj=()=>new __c.bGl;this.Sb=__c.Tb}};var gIl=class{static G(a){__c.O(a,{M3f:CL})}async E2(a,b){const c=this.Sb.now();b=new __c.xB({id:__c.Qb(),brand:"",status:"UPLOADING",Bo:!0,segment:1,kc:1,metadata:new __c.yB({title:a.name,rr:b?.duration||0,ROa:b?.duration||0}),Og:c,Mt:c});await this.qH.add({file:a.content,Ksb:new __c.i0h({id:b.id,type:3,name:a.name,mimeType:a.type,ka:this.ka,Og:c})});return new eIl(b,{upload:d=>this.M3f(d,a)})}M3f(a,b){const c=this.$rg(b.content),d=[];b.type.startsWith("audio/x-m4a")?d.push(new __c.b4c({g1a:new __c.a4c({container:2}),
url:c})):d.push(new __c.b4c({g1a:new __c.a4c({container:1}),url:c}));a.finish(new __c.xB({...a.audio,files:d,status:"IMPORTED"}));return a.finished}constructor(a,b,c=URL.createObjectURL,d=__c.Tb){this.ka=a;this.qH=b;this.$rg=c;this.Sb=d;gIl.G(this)}};var hIl=__c.F(()=>({id:__c.hp(1),ezk:__c.U(2),ckt:__c.U(3)}));var iIl=UHl("design-upload"),lIl=class{static G(a){__c.O(a,{progress:RHl.ref,_error:RHl.ref,finished:RHl.ref})}Hmb(a){ra(a>=0&&a<=1);this.Jcb==null&&(this.Jcb=this.progress);this.progress=this.Jcb+(1-this.Jcb)*jIl*a}l4(){this.progress+=(1-this.progress)*Math.random()*kIl}get error(){return this._error}set error(a){rHl(()=>this._error=a);this.resolve()}start(){return this.J4s(this)}retry(){this.error=void 0;sHl(this);return this.LYf(this)}finish(a){ra(a.length>=1);this.wGa=a.slice();this.progress=
1;this.resolve()}constructor(a,b,c){this.J4s=a;this.LYf=b;this.Jcb=(lIl.G(this),void 0);this.progress=0;this.pxa="UPLOAD-"+Math.ceil(iIl()*1E4);sHl(this);this.metrics=c?.metrics;this.HJ=c?.HJ}},jIl=.5,kIl=.2;var mIl=class{async E2(a,b){let c;this.V&&(c=b.va?this.V.startSpan("upload_design_file",b.va):this.V.wb("upload_design_file"));const d=this.OUj(c),e=new lIl(f=>tHl(this,a,f,b?.GSf,c,d,b?.Zqi),f=>tHl(this,a,f,b?.GSf,c,void 0,b?.Zqi),{metrics:d,HJ:b?.HJ});e.l4();d.Il("initialization_finished");return e}poll(a,b){const c=new hIl({id:m(a.asq)});let d;const e=a.metrics;__c.e8e(a,async()=>{({jvd:d}=await this.npb.H2m(c,{va:b}));switch(d.status){case eGl.RESERVED:case eGl.LFp:case eGl.vEh:case eGl.$2o:case eGl.Snj:case eGl.g5l:case eGl.C1l:case eGl.w2l:return"pending";
case eGl.Vbg:return e?.finish({success:!1}),"failure";case eGl.sIh:return e?.finish({success:!0}),"success";default:throw new __c.u(d.status);}},CL(f=>{f==="success"?({EL:f}=m(d),a.finish(f)):f==="pending"?a.l4():f==="failure"&&(a.error=new __c.Gjh(d?.errorMessage,void 0,{ELb:d?.ELb}))}),{Sb:this.Sb})}constructor(a,b,c,d=f=>new __c.bGl(f),e=__c.Tb){this.npb=a;this.QKa=b;this.V=c;this.OUj=d;this.Sb=e}};var nIl=class{static G(a){__c.O(a,{finished:RHl.ref,um:CL,l4:CL,Hmb:CL,retry:CL})}um(a){this.HM.forEach(b=>b.error=a)}l4(){const [a,...b]=this.HM;a.l4();b.forEach(c=>c.progress=a.progress)}Hmb(a){ra(a>=0&&a<=1);const [b,...c]=this.HM;b.Hmb(a);c.forEach(d=>d.progress=b.progress)}start(){Promise.all(this.HM.map(({finished:a})=>a)).then(()=>this.resolve());return m(this.Oy)()}retry(){this.YUc();this.HM.forEach(a=>a.reset());return this.start()}YUc(){this.finished=new Promise(a=>{this.resolve=a})}constructor(a){this.HM=
(nIl.G(this),[]);this.HJ=a.HJ;this.YUc()}};var oIl=class{async E2(a,b){ra(b.ZUe>0);const c=b.ZUe,d=b.K6,e=b.HJ,f=this.V&&b.va?this.V.startSpan("upload_grouped_media_file",b.va):void 0,g=new nIl({HJ:e}),h=a.name,{uRr:k,iRr:l}=await this.Hgb(c,h,d,f),n=async(q,r)=>this.retry(g,q,r),p=(await Promise.all(l)).map((q,r)=>new __c.h8e(new __c.lt({...q,QC:h}),{retry:n,metrics:k[r],HJ:e,Kt:!0}));g.HM=p;uHl(g,async()=>this.upload(g,p,a,k,f));g.l4();k.forEach(q=>q.Il("initialization_finished"));return g}async Hgb(a,b,c,d){const e=[];a=Array.from({length:a}).map(async(f,
g)=>{f=new __c.bGl(g===0?d:void 0);e.push(f);let h;try{h=await this.sc.Hgb(new __c.Vei({body:new __c.Edd({QC:b,Bo:!0,Kt:!0})}),{va:d}),f.Il("resource_created")}catch(k){throw f.finish({success:!1}),k;}if(c){if(!this.Zd)throw Error("Tried to upload to a folder, but the folder-service is not present");__c.$Fl(this.Zd,c,h,this.Czb,this.vzf)}return h});return{uRr:e,iRr:a}}async upload(a,b,c,d,e){d.forEach(h=>h.Il("file_upload_started"));var f=b.map(({media:h},k)=>({mediaId:h.id,M0g:h.Qb.version,index:k}));
f=new __c.GGl({mimeType:c.type,VDg:__c.cGl(c.name),targets:f});const g=h=>{h.lengthComputable?a.Hmb(h.loaded/h.total):a.l4()};try{await this.QKa.upload({backend:"grouped-media",file:c,strategy:0,metadata:f,va:e,Jka:g}),d.forEach(h=>h.Il("file_upload_finished")),a.l4(),this.poll(b,e)}catch(h){d.forEach(k=>k.finish({success:!1})),this.errorService?.error(h),a.um(new dNg(h,h instanceof __c.QFl?h.httpStatusCode:void 0))}}poll(a,b){a=a.filter(({media:d})=>__c.UFl(d));const c=new Map(a.map(d=>[d.media.id,
d.media]));PGl(a,d=>d.media.id,async d=>{d=__c.Gl(d.map(e=>`${e}:1`),100);return(await Promise.all(d.map(async e=>this.sc.Asa(new __c.km({refs:e,projection:__c.hm([8,14,2]),J3:[4,5,6,7,8]}),{va:b})))).flatMap(({media:e})=>e).map(e=>{c.set(e.id,e);let f="unknown";__c.UFl(e)?f="pending":__c.TFl(e)&&__c.dGl.KHf(e)?f="success":__c.VFl(e)&&(f="failure");return{id:e.id,status:f}})},(d,e)=>{const f=m(c.get(d.media.id)),g=d.metrics;e==="pending"?d.l4(f):e==="success"?(g?.finish({success:!0}),d.finish(f)):
e==="failure"&&(g?.finish({success:!1}),f.Qb.Hli===1&&(d.error=new __c.cNg("upload failed, image resolution too high")))},{Sb:this.Sb})}async retry(a,b,c){if(c instanceof __c.b8e)return b.retry();await a.retry()}constructor(a,b,c,d,e){this.sc=a;this.QKa=b;this.Zd=c;this.errorService=d;this.V=e;this.Czb=void 0;this.Sb=__c.Tb;this.vzf=new Map}};var pIl=class{async E2(a,b={}){ra(b.media==null);ra(b.Cab==null||b.Cab.Wd===2);ra(b.aVe==null);var c=a.type==="application/svg+xml"?2:1;c=new __c.lt({id:__c.Qb(),user:this.userId,brand:"",QC:a.name,wha:!1,Ru:[4],Bo:!0,kc:new __c.Yec,u1b:!1,Cab:b.Cab,type:c,Qb:new __c.Bbi({version:1,Kt:b.Kt??!0,background:!1,tha:!1,isolated:!1,qfe:!1,sme:!1,Xxc:!1,mA:!1,status:1,sT:1,kc:1,files:[],Mt:this.Sb.now()}),created:this.Sb.now(),updated:this.Sb.now()});await this.qH.add({file:a.content,Ksb:new __c.i0h({id:c.id,
type:1,name:a.name,mimeType:a.type,deviceId:b.Cab?.id,ka:this.ka,Og:c.created})});return new __c.h8e(c,{upload:d=>this.M3f(d,a),retry(){throw Error("Not implemented");}})}async M3f(a,b){const c=this.$rg(b.content),d=await this.uR(c);b=[4,10].map(e=>new __c.Djh({page:0,width:d.naturalWidth,height:d.naturalHeight,quality:e,rf:"",key:"",De:!1,Cn:!1,hu:!1,mimeType:"",url:c}));a.finish(new __c.lt({...a.media,Qb:new __c.Bbi({...a.media.Qb,status:3,sT:3,files:b})}));return a.finished}poll(){throw Error("Not implemented");
}constructor(a,b,c){var d=URL.createObjectURL;this.userId=a;this.ka=b;this.qH=c;this.$rg=d;this.uR=__c.Ds;this.Sb=__c.Tb}};var qIl=class{async E2(a,b={width:0,height:0}){const {width:c,height:d,contentType:e=5,duration:f=0}=b;b=new __c.Bh({id:__c.Qb(),user:this.userId,status:"UPLOADING",contentType:__c.Dh.serialize(e),uv:f,width:c,height:d,Bo:!0,Ru:[4],segment:1,kc:1,w_:1,Og:this.Sb.now(),Mt:this.Sb.now()});await this.qH.add({file:a.content,Ksb:new __c.i0h({id:b.id,type:2,name:a.name,mimeType:a.type,ka:this.ka,Og:b.Og})});return new __c.Kjh(b,{upload:g=>this.M3f(g,a),retry:()=>{throw Error("Not implemented");}},{$pl:!1})}async M3f(a,
b){const c=this.$rg(b.content),d=a.video.width,e=a.video.height;b=b.type.startsWith("image/gif")?2:1;a.finish(new __c.Bh({...a.video,mMa:1,w_:a.video.w_??a.video.Bo?1:2,status:"IMPORTED",WG:[new __c.Ch({width:d,height:e,container:b,url:c})]}));return a.finished}poll(){throw Error("Not implemented");}constructor(a,b,c){var d=URL.createObjectURL;this.userId=a;this.ka=b;this.qH=c;this.$rg=d;this.Sb=__c.Tb}};var rIl=class{async E2(a,b={width:0,height:0}){const c=this.V&&b.va?this.V.startSpan("upload_video_file",b.va):void 0,d=new __c.bGl(c),{video:e,iNf:f,m2a:g}=b.DQq??await this.w9b(a,b,d,c);b.K6&&(this.Czb?await vHl(this,b.K6.id)&&wHl(this,e,b.K6):wHl(this,e,b.K6));let h;if(this.QKa&&(this.Q8f!=null&&a.content.size<=this.Q8f||this.Epl!=null))h=k=>this.OWl(k,e,a,d,c);else if(f)h=k=>xHl(this,k,a,f,d,c);else if(g)h=k=>yHl(this,k,a,g,d,c);else throw Error("Cannot upload video for already existing file");
d.Il("initialization_finished");return new __c.Kjh({...e,uv:b.duration},{upload:h,retry:(k,l)=>this.retry(k,l)},{HJ:b.HJ,metrics:d})}async w9b(a,b,c,d){try{const e=a.content.size>(this.UUr||Infinity),{video:f,m2a:g,iNf:h}=await this.Cg.w9b(new __c.kTg({Gi:this.X.Ab.brand.id,Iba:this.X.user.id,uCo:a.name,width:b.width,height:b.height,contentType:b.contentType,JCa:a.content.size,v2g:e}),{va:d});c.Il("resource_created",new Map([["multipart_upload",e]]));return{video:f,m2a:g,iNf:h}}catch(e){throw c.finish({success:!1}),
this.errorService?.error(e),e;}}async OWl(a,b,c,d,e){ra(this.QKa!=null);d.Il("file_upload_started");const f=CL(g=>{g.lengthComputable?a.Hmb(g.loaded/g.total):a.l4()});b=new __c.HGl({videoId:b.id,mimeType:c.type});if(this.Q8f&&c.content.size<=this.Q8f)c={backend:"video",file:c,strategy:0,metadata:b,va:e,Jka:f};else if(this.Epl)c={backend:"video",file:c,strategy:1,metadata:b,chunkSize:this.Epl,va:e,Jka:f,Qgs:()=>a.l4()};else throw Error("Upload strategy could not be determined.");try{await this.QKa.upload(c),
d.Il("file_upload_finished")}catch(g){d.finish({success:!1});this.errorService?.error(g);a.error=new dNg(g,g instanceof __c.QFl?g.httpStatusCode:void 0);return}this.poll(a,e);return a.finished}poll(a,b){const c=new __c.wB({id:a.video.id,qrb:!0,Xsc:!0,Ysc:!0,orb:!0});let d=a.video;const e=a.metrics;__c.e8e(a,async()=>{({video:d}=await this.Cg.BM(c,{va:b}));return d.segment===3?"unknown":d.status==="UPLOADING"||d.status==="PROCESSING"?"pending":d.status==="FAILED"?"failure":d.status==="IMPORTED"?"success":
"unknown"},CL(f=>{if(f==="pending")if(d.mMa){f=d.mMa/100;var g=d;ra(f>=0&&f<=1);a.qcl==null&&(a.qcl=a.progress);a.progress=a.qcl+.3*f;__c.k8e(a,g)}else a.l4(d);else f==="failure"?e?.finish({success:!1}):f==="success"&&(e?.finish({success:!0}),a.finish(d))}),{Sb:this.Sb})}retry(a,b){b instanceof __c.b8e?this.poll(a):a.start();return a.finished}constructor(a,b,c,d,e,f,g,h,k,l){this.X=a;this.Cg=b;this.vs=c;this.QKa=d;this.Zd=e;this.errorService=f;this.V=g;this.UUr=h;this.Q8f=k;this.Epl=l;this.Czb=void 0;
this.Sb=__c.Tb;this.vzf=new Map}};var sIl=class extends Error{};var tIl=class{gGc(a){return!!this.Yxa.find(b=>a.includes(b))}async rFa(a,b){ra(a.length>0,"Nothing to upload");b.yt?.("audio");if(!await this.$p.mYb())throw new __c.e0h;var c=new INg;const d=await this.HFg(a,c);b.ySc?.({files:[],K8:c});let e;const f=[],g=[],h=[],k=[];c=d.map(async l=>{let n=!0;try{const p=await this.bwb.run(()=>this.Xmc(l,a.indexOf(l),b));h.push(p);k.push(this.Oak(p));f.push(l)}catch(p){n=!1,p instanceof sIl?g.push(l):(f.push(l),e=p)}finally{b.U8g?.({type:"audio",file:l,success:n})}});
await Promise.allSettled(c);c=new INg;c.rEc(3,...g);b.ySc?.({files:f,K8:c});if(e)throw e;return h.map((l,n)=>({type:"audio",upload:l,finished:k[n]}))}Oak(a){return this.bwb.run(()=>this.FLc(a))}async Xmc(a,b,c){const d=c.Wza,e=c.HJ;let f;try{f=await this.LVb(a.type).handle(a.content),a.content=f.file}catch(h){throw new sIl;}if(!f.duration)throw new sIl;const g=await this.eUp.get().E2(a,{duration:f.duration,yQq:a.jUm,HJ:e});if(!f.Bck){const h=a.type==="audio/x-m4a"?2:1,k=this.url.createObjectURL(f.file);
rHl(()=>{g.audio={...g.audio,files:[{g1a:{container:h,fPo:void 0},reference:void 0,url:k,XGa:void 0}]}})}this.$p.cig(g,a.content.size);a={type:"audio",upload:g,j9e:c.Pnb,file:a,index:b,K6:void 0,Kk:[],duration:f.duration,GE:[g.audio.id],HJ:e};d&&d(a);this.eNd(a,c);return g}async FLc(a){a.start();await a.finished;return a}eNd(a,{hqa:b,Qjb:c}){const d=a.upload,e=AHl(()=>d.error,g=>{g&&(g={...a,error:g},c&&c(g))}),f=AHl(()=>d.finished,g=>{g.then(()=>{d.error==null&&(f(),e(),this.$p.dNb(),this.$p.ngh(d),
b&&b(a))})},{fireImmediately:!0})}async fCc(a){if(!this.Yxa.includes(a.type.split(";")[0]))return 0;if(a.content.size>this.cUp)return 1;if(!a.content.size||!this.utf&&!(await zHl(a)).valid)return 3}async HFg(a,b){const c=[];for(const d of a)a=await this.fCc(d),a!==void 0?b.rEc(a,d):c.push(d);return c}constructor(a,b,c,d,e,f){var g=__c.dH.Mob,h=URL;this.eUp=a;this.bwb=b;this.$p=c;this.Yxa=d;this.cUp=e;this.utf=f;this.LVb=g;this.url=h}};var uIl=class{gGc(a){return this.O$a.includes(a)}async rFa(a,b){ra(a.length>0,"Nothing to upload");const {Wvi:c}=b.yt?.("design")??{},d=new INg,e=await this.tAj(a,d);a=e.filter(({valid:f})=>f).map(({file:f})=>f);b.ySc?.({files:a,K8:d});a=a.map(async f=>{const g=e.findIndex(k=>k.file===f);let h=!0;try{const k=await this.bwb.run(()=>this.Xmc(f,g,c,b)),l=this.bwb.run(()=>this.FLc(k));return{type:"design",upload:k,finished:l}}catch(k){throw rHl(()=>d.Tgd=!0),h=!1,k;}finally{b.U8g?.({type:"design",file:f,
success:h})}});return Promise.all(a)}async Xmc(a,b,c,d){const e=d.Wza,f=d.HJ;c=await this.Imb.E2(a,{HJ:f,va:c});a={type:"design",upload:c,j9e:d.Pnb,file:a,index:b,K6:d.K6,Kk:[],HJ:f};e&&e(a);this.eNd(a,d);return c}async FLc(a){a.start();await a.finished;return a}eNd(a,{Qjb:b,hqa:c}){const d=AHl(()=>a.upload.error,f=>{f&&(f={...a,error:f},b&&b(f))}),e=BHl(()=>{a.upload.finished.then(()=>{if(a.upload.error==null){e();d();var f={...a,GE:a.upload.wGa};c&&c(f)}})})}async fCc(a){if(!this.O$a.includes(a.type))return 0;
var b=a.content.size;const c=this.Bsf.scd.get(a.type);if(b>(c?c:this.Bsf.Qyb))return 1;if(!a.content.size)return 3}async tAj(a,b){const c=[];for(const d of a)a=await this.fCc(d),a!==void 0&&b.rEc(a,d),c.push({valid:a===void 0,file:d});return c}constructor(a,b,c,d){this.Imb=a;this.bwb=b;this.O$a=c;this.Bsf=d}};var vIl=class{gGc(a){return this.D7m.includes(a)}async rFa(a,b){ra(a.length>0,"Nothing to upload");const {Wvi:c}=b.yt?.("media")??{};if(this.$p&&!await this.$p.mYb())throw new __c.e0h;const d=new INg,e=await this.tAj(a,d);a=e.filter(({valid:f})=>f).map(({file:f})=>f);b.ySc?.({files:a,K8:d});a=a.map(async f=>{const g=e.findIndex(n=>n.file===f),h=e[g].NUq;let k=!0,l;try{const n=await this.bwb.run(()=>this.Xmc(f,g,c,b,h));l=n.HM.length;this.bwb.run(()=>this.FLc(n));return n.HM.map(p=>({type:"media",
upload:p,finished:Promise.resolve(p.finished).then(()=>p)}))}catch(n){throw rHl(()=>d.Tgd=!0),k=!1,n;}finally{b.U8g?.({type:"media",file:f,success:k,V8f:l})}});return(await Promise.all(a)).flat()}async Xmc(a,b,c,d,e){const f=d.Wza,g=d.K6,h=d.HJ,k=e.ZUe,l=e.img;if(!k||k<=0)throw new RangeError("No media found in the file");c=await this.Imb.E2(a,{ZUe:k,va:c,K6:g,HJ:h});c.HM.forEach(n=>{n={type:"media",upload:n,j9e:d.Pnb,file:a,index:b,K6:g,Kk:[l],GE:[n.media.id],HJ:d.HJ};f&&f(n);CHl(n,d)});DHl(this,
c);this.$p?.cig(c,a.content.size);return c}async FLc(a){a.start();await a.finished;return a}async tAj(a,b){const c=[];for(const d of a){a=this.LVb(d.type).handle(d.content);const e=await EHl(this,d,a);e!=null&&b.rEc(e,d);c.push({valid:e==null,file:d,NUq:await a})}return c}async fCc(a){const b=this.LVb(a.type).handle(a.content);return await EHl(this,a,b)}constructor(a,b,c,d,e,f){var g=__c.dH.Mob;this.Imb=a;this.bwb=b;this.$p=c;this.D7m=d;this.V0g=e;this.EAn=f;this.LVb=g}};JNg=__c.JNg={};JNg.gmp=bIl;JNg.zHp=YHl;JNg.wcq=function(a){const b=a.bootstrap;var c=a.qH,d=a.qa;const e=new aLf(2),f=new fIl(m(a.X),a.Mr,a.vs,b.RNq?a.QKa:void 0,a.errorService);c=c&&new gIl(m(a.ka),c);d=GHl(d,f,c);return new tIl(d,e,m(a.$p),b.Yxa,b.lim.Qyb,b.bUp)};JNg.beq=function(a){const b=new mIl(a.npb,a.QKa,a.Ha.Vd("editor.design_upload_controller")),c=new aLf(2);a=a.bootstrap;return new uIl(b,c,a.O$a,a.Bsf)};
JNg.zfq=function(a){const b=a.bootstrap,c=new oIl(a.sc,a.QKa,a.Zd,a.errorService,a.Ha.Vd("editor.grouped_media_upload_controller")),d=new aLf(2);return new vIl(c,d,a.$p,b.P5d,b.VEd,b.Odm)};JNg.Ugq=function(a){const b=a.bootstrap;var c=a.qH,d=new __c.dGl(a.sc,a.QKa,a.Zd,a.errorService,a.Ha.Vd("editor.media_upload_controller"));c=c&&new pIl(a.X?.user.id,m(a.ka),c);d=GHl(a.qa,d,c);c=new aLf(2);return new HHl(d,c,a.$p,b.mwa,b.VEd,b.qTk)};
JNg.$kq=function(a){const b=a.bootstrap;var c=a.qH;const d=m(a.X),e=new aLf(2);var f=new rIl(d,a.Cg,a.vs,a.QKa,a.Zd,a.errorService,a.Ha.Vd("editor.video_upload_controller"),b.kst,b.Q8f,b.JJs);c=c&&new qIl(d.user.id,m(a.ka),c);f=GHl(a.qa,f,c);return new JHl(f,e,m(a.$p),b.aja,b.zcj,b.aco,b.BLm,b.ist)};
JNg.gor=function({K8:a,AP:b,q2:c}){const d=CL(na=>{a.Tgd=!1;na&&na()}),e=DL(({onClose:na})=>BL(__c.oGl,{open:a.Tgd,onClose:()=>d(na)})),f=CL(na=>{a.PVd=!1;na&&na()}),g=DL(({onClose:na})=>BL(__c.qGl,{open:a.PVd&&c==null,onClose:()=>f(na)}));BHl(()=>{a.PVd&&c!=null&&(c("upload_quota_error","paywall"),f())});const h=CL((na,qa)=>{na=[na];for(const ua of na)a.$2d.delete(ua);a.hasError||qa&&qa()}),k=CL((na,qa)=>{na=[na];for(const ua of na)a.QLc.delete(ua);a.hasError||qa&&qa()}),l=CL((na,qa)=>{na=[na];for(const ua of na)a.FAf.delete(ua);
a.hasError||qa&&qa()}),n=DL(({onClose:na})=>{const qa=PHl(()=>h(0,na),[na]),ua=AL(a,0);return b.aja.length?b.Yxa.length?b.O$a.length?BL(__c.wGl,{files:ua,onClose:qa}):BL(__c.vGl,{files:ua,onClose:qa}):BL(__c.uGl,{files:ua,onClose:qa}):BL(__c.tGl,{files:ua,onClose:qa})}),p=na=>b.Yxa.some(qa=>qa.endsWith(na.type)),q=na=>b.aja.some(qa=>qa.endsWith(na.type)),r=na=>b.O$a.some(qa=>qa.endsWith(na.type));let t,v;b.Uvf?(t=na=>b.mwa.some(qa=>qa.endsWith(na.type)),v=na=>!p(na)&&!q(na)&&!r(na)&&!t(na)):(t=na=>
!q(na)&&!p(na)&&!r(na),v=()=>!1);const w=b.lim.Qyb,x=b.Bsf.Qyb,y=b.VEd.Qyb,z=b.zcj.Qyb,B=b.SUq?.Qyb,C=DL(({onClose:na})=>{const qa=AL(a,1),ua=PHl(()=>h(1,na),[na]);return BL(__c.xGl,{onClose:ua,zza:qa.filter(t),gDn:y,bDn:b.VEd.scd,HP:qa.filter(p),YTp:w,ow:qa.filter(q),Zrt:z,Srq:qa.filter(r),fsq:x,$rq:b.Bsf?.scd,files:qa.filter(v),PUq:B})}),G=$Gl("application/json",b.zcj),H=DL(({onClose:na})=>{const qa=PHl(()=>h(4,na),[na]);return BL(__c.yGl,{aOr:G,files:AL(a,4),onClose:qa})}),K=$Gl("application/json",
b.aco),L=Math.max(K?.width||0,K?.height||0),N=DL(({onClose:na})=>{const qa=PHl(()=>h(5,na),[na]);return BL(__c.zGl,{LNr:L,files:AL(a,5),onClose:qa})}),P=$Gl("application/json",b.BLm,0),T=DL(({onClose:na})=>{const qa=PHl(()=>h(6,na),[na]);return BL(__c.AGl,{WNr:P,files:AL(a,6),onClose:qa})}),V=DL(({onClose:na})=>{const qa=PHl(()=>h(7,na),[na]);return BL(__c.BGl,{files:AL(a,7),onClose:qa})}),W=DL(({onClose:na})=>{const qa=PHl(()=>h(3,na),[na]);return BL(__c.rGl,{files:AL(a,3),onClose:qa})}),aa=DL(({onClose:na})=>
{const qa=PHl(()=>h(2,na),[na]);return BL(__c.sGl,{files:AL(a,2),onClose:qa})}),ba=DL(({onClose:na})=>{const qa=PHl(()=>k(1,na),[na]),ua=a.QLc.get(1)||[];return ua.length?BL(ZHl,{Ba:ua[0],onClose:qa}):null}),da=DL(({onClose:na})=>{const qa=PHl(()=>k(2,na),[na]);return(a.QLc.get(2)||[]).length?BL($Hl,{onClose:qa}):null}),la=DL(({onClose:na})=>{const qa=PHl(()=>k(0,na),[na]),ua=a.QLc.get(0)||[];return ua.length?BL(aIl,{Ue:ua.map(za=>za.title),onClose:qa,Dac:ua[0].Xpa,qFb:ua[0].Gwi}):null}),ja=DL(({onClose:na})=>
{const qa=PHl(()=>l(0,na),[na]);return a.FAf.get(0)?BL(KHl,{onClose:qa}):null}),oa=DL(({onClose:na})=>{const qa=AL(a,8),ua=PHl(()=>h(8,na),[na]);return qa.length?BL(LHl,{onClose:ua,YQk:b.Odm??50}):null}),ma=DL(({onClose:na})=>{const qa=AL(a,9),ua=PHl(()=>h(9,na),[na]);return qa.length?BL(MHl,{onClose:ua}):null});return DL(({onClose:na})=>{var qa={Dialog:e,R5:a.Tgd};const ua={Dialog:g,R5:a.PVd&&c==null},za={Dialog:n,R5:AL(a,0).length},va={Dialog:C,R5:AL(a,1).length},xa={Dialog:H,R5:AL(a,4).length},
Ba={Dialog:N,R5:AL(a,5).length},pa={Dialog:T,R5:AL(a,6).length},ia={Dialog:V,R5:AL(a,7).length},wa={Dialog:oa,R5:AL(a,8).length},Ca={Dialog:ma,R5:AL(a,9).length},Ha={Dialog:W,R5:AL(a,3).length},Oa={Dialog:aa,R5:AL(a,2).length},Ka={Dialog:ba,R5:(a.QLc.get(1)||[]).length},Ua={Dialog:da,R5:(a.QLc.get(2)||[]).length},cb={Dialog:la,R5:(a.QLc.get(0)||[]).length},ab={Dialog:ja,R5:a.FAf.get(0)||!1};return(qa=[Ua,Ka,cb,ab,qa,ua,va,xa,Ba,pa,ia,wa,Ca,za,Ha,Oa].find(Ta=>Ta.R5))&&BL(qa.Dialog,{onClose:na})})};
}).call(self, self._456c437108d2d2713799e19380be528d);}

}])
//# sourceMappingURL=sourcemaps/08799c10c8f72ae6.js.map