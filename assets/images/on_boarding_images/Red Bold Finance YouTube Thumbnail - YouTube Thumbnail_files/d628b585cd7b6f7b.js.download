(self["webpackChunk_canva_web"] = self["webpackChunk_canva_web"] || []).push([[34957],{

/***/ 644958:
function(_, __, __webpack_require__) {__webpack_require__.n_x = __webpack_require__.n;const __web_req__ = __webpack_require__;__web_req__(905716);__web_req__(188244);__web_req__(184626);__web_req__(764820);__web_req__(100191);__web_req__(361753);self._456c437108d2d2713799e19380be528d = self._456c437108d2d2713799e19380be528d || {};(function(__c) {var M=__c.M;var m=__c.m;var u=__c.u;
var V0w=function(a){if(a!=null)return a.search(/-[a-z]$/)===-1?a+"-a":a},b1w=async function(a,b,c){switch(c.type){case "UPLOAD_MEDIA":return await a.V.ug("upload_media",b,d=>a.Hgb(c,d)),async()=>{};case "UPLOAD_VIDEO":return await a.V.ug("upload_video",b,d=>a.Hgb(c,d)),async()=>{};case "CREATE_DEVICE_VIDEO":return await a.V.ug("create_device_video",b,d=>a.Hgb(c,d)),async()=>{};case "RESIZE_TO_DOCTYPE":return a.V.CZc("resize_to_doctype",async()=>W0w(a,c));case "RESIZE_TO_DIMENSIONS":return a.V.CZc("resize_to_dimensions",async()=>
X0w(a,c));case "REPLACE_WITH_TEMPLATE":return()=>Promise.resolve();case "SET_TITLE":return a.V.CZc("set_title",async()=>Y0w(a,c));case "UPDATE_PAGE":return a.V.CZc("update_page",()=>a.sVl(c));case "SELECT_ELEMENT_BY_MEDIA_ID":return a.V.CZc("select_element_by_media_id",async()=>Z0w(a,c));case "SELECT_FIRST_ELEMENT":return a.V.CZc("select_first_element",async()=>a.yVi());case "SELECT_PAGE":return a.V.CZc("select_page",async()=>$0w(a,c));case "SELECT_PAGE_BY_ID":return a.V.CZc("select_page_by_id",async()=>
a1w(a,c));case "OPEN_RESIZING_MENU":return a.V.CZc("open_resizing_menu",async()=>a.w3e?.O6a?.());default:throw new u(c);}},W0w=function(a,{doctype:b,eb:c}){const d=c1w(a);a.ZDe.xqa(b,c);b=c1w(a);a.N.track(d1w,{ka:a.session.id,source:"init",I0m:d.Ea,J0m:d.u4h,H0m:d.s4h,G0m:d.eb,SJo:b.Ea,TJo:b.u4h,RJo:b.s4h,IJo:b.eb})},X0w=function(a,{dimensions:b,eb:c}){const d=c1w(a);a.ZDe.xqa(b,c);b=c1w(a);a.N.track(d1w,{ka:a.session.id,source:"init",I0m:d.Ea,J0m:d.u4h,H0m:d.s4h,G0m:d.eb,SJo:b.Ea,TJo:b.u4h,RJo:b.s4h,
IJo:b.eb})},Y0w=function(a,{title:b}){a.session.document.title=b},Z0w=function(a,{mediaId:b}){for(const d of a.session.document.pages){if(d.type==="responsive")continue;const e=a.Ai.xb(d);var c=e.type==="concatenated-fixed-page"?e.ia.pages.map(f=>e.xb(f)):[e];for(const f of c){if((c=f.ia.Hc.first())&&c.image.ref?.media.id===b){a.vg.YU(f.container,f.ia);a.viewport.uE(f);return}for(const g of f.ia.elements)switch(g.type){case "group":for(const h of g.pb)switch(h.type){case "rect":if(h.fill.image.ref?.media.id===
b){a.vg.KUe(f.Me(g),h);return}break;case "grid":for(const k of h.cells.values())if(k.fill.image.ref?.media.id===b){a.vg.EVc(f.Me(h),k);return}break;case "chart":case "table":case "line":case "text":case "shape":case "embed":case "controlled":break;case "group":__c.hbe("ActionPerformer::selectElementByMediaId");break;case "layout":__c.oo("ActionPerformer");break;case "sheet":__c.Xe("ActionPerformer");break;default:throw new u(h);}break;case "grid":for(const h of g.cells.values())if(h.fill.image.ref?.media.id===
b){a.vg.EVc(f.Me(g),h);return}break;case "rect":if(g.fill.image.ref?.media.id===b){a.vg.Jl(f,g);return}break;case "shape":for(const h of g.paths)if(h.fill.image.ref?.media.id===b){a.vg.Bie(f.Me(g),h);return}break;case "chart":case "table":case "line":case "text":case "embed":break;case "controlled":__c.Aue("ActionPerformer");break;case "sheet":__c.Xe("ActionPerformer");break;case "layout":__c.oo("ActionPerformer");break;default:throw new u(g);}}}},$0w=function(a,{Bd:b}){if(b=a.session.document.pages.toArray()[b-
1])a.vg.BEb(b),a.viewport.Uw(b)},a1w=function(a,{nh:b}){const c=a.session.document.pages.toArray().find(d=>d.id===b);c&&(a.vg.BEb(c),a.viewport.Uw(c))},e1w=async function({blob:a}){a=await __c.z1c(a);({url:a}=JSON.parse(a));try{const b=await fetch(a);if(!b.ok)throw Error("Failed to fetch local media with url");return await b.blob()}catch(b){throw Error("Failed to fetch local media with url");}},h1w=async function(a,{pQc:b,name:c,blob:d,span:e}){const f=f1w(a),{url:g,width:h,height:k,V9a:l,duration:n,
k0m:p}=await a.getVideoInfo(d),q=await a.V.ug("create_video",e,()=>a.Cg.w9b(new __c.kTg({Gi:f.Ab.brand.id,Iba:f.user.id,width:h,height:k,uCo:c}))),r=m(q.m2a),t=q.video;try{const v=new __c.Rub({url:g,width:h,height:k,De:!1,container:1}),w=new __c.nm({id:t.id,title:t.title,files:[v],width:h,height:k,rr:n,contentType:"VIDEO",$K:"UPLOADING",rB:[new __c.Vub({url:p.src,startUs:0})]});g1w(()=>a.dc.fxb(w));a.Avi.set(b,{id:t.id,width:h,height:k,mimeType:d.type})}catch(v){throw l&&URL.revokeObjectURL(l),v;
}a.V.ug("upload_video",e,async()=>{try{await (await a.hbj({video:t,m2a:r},d,c)).finished}finally{l&&URL.revokeObjectURL(l)}})},i1w=async function(a,{K2h:b,blob:c,span:d}){const e=f1w(a);var f=await __c.z1c(c);f=JSON.parse(f);const g=__c.Ypd.deserialize(f),h=new __c.lTg({Gi:e.Ab.brand.id,Iba:e.user.id,width:g.width,height:g.height,sourceId:g.localMediaKey}),{m2a:k,video:l}=await a.V.ug("create_video",d,async()=>a.Cg.w9b(h));if(k)if(a.rba?.g3){var n=await a.rba.g3({localMediaKey:g.localMediaKey,thumbnail:!1});
await a.V.ug("upload_to_s3",d,()=>a.vs.upload({file:{content:n,name:g.localMediaKey,type:n.type},url:k.D5,OV:k.params}));await a.Cg.pbb(new __c.USj({id:l.id}));await a.dc.XF(l);a.Avi.set(b,{id:l.id,width:g.width,height:g.height,mimeType:c.type})}else a.errorService.error(Error("Create device video init action called but getLocalImageBlob is undefined"));else await a.dc.XF(l),a.Avi.set(b,{id:l.id,width:g.width,height:g.height,mimeType:c.type})},f1w=function(a){const b=a.X;if(!b)throw a.Ga(({onClose:c})=>
j1w(__c.ld,{onClose:c,title:M("i2iZ/g"),explanation:M("tg/C2Q"),button:{children:M("iDD1Nw")}})),Error("cannot upload video while anonymous");return b},c1w=function(a){const b=a.session.document.doctype,c=__c.sg(4,a.session.document.dimensions);return{Ea:b.type==="reference"?b.id:"custom",u4h:c.width,s4h:c.height,eb:a.session.eb}},o1w=async function(a,b,c){switch(c.type){case "SET_TITLE":k1w(b.ia,c);break;case "SET_BACKGROUND":a.lnh(b.ia,c);break;case "APPLY_TEMPLATE":break;case "SET_TEXT":l1w(a,
b,c);break;case "SET_FILLS":await m1w(a,b.ia,c);break;case "RESIZE_PAGE_TO_DOCTYPE":n1w(a,b.ia,c);break;case "RESIZE_PAGE_TO_DIMENSIONS":a.Wbo(b.ia,c);break;default:throw new u(c);}},k1w=function(a,{title:b}){a.title=b},l1w=function(a,b,c){const d=p1w(b.ia),e=[],f=new Map;for(const [k,l]of c.actions){var g=d.get(k);if(!g)continue;c=g.text;g=g.container;var h=c.text;l.content&&(h.Ywa(l.content+"\n"),c.Jea=!1);let n=l.attributes;if(n.size>0){const p=n.get("font-size");p!=null&&(n=(new Map(n)).set("font-size",
String(4*parseFloat(p)/3)));h.setAttributes(__c.Ce(n))}g?(h=f.get(g),h||(h=[],f.set(g,h)),h.push(c)):e.push(c)}a.PIs.finally(q1w(()=>{for(const k of e)a.kd.K0(b,k);for(const [k,l]of f)a.kd.I5(b,k,l)}))},m1w=async function(a,b,{A5a:c}){const d=f=>{if(f){var g=__c.e3i(f);g=g?c.get(g):void 0;g||(f=V0w(f),g=f!=null?c.get(f):void 0);return g}},e=b.elements.flatMap(f=>{if(f.type==="rect"){var g=d(f.TB);return g?[{fill:f.fill,u6e:g,container:f}]:[]}if(f.type==="grid"&&(g=f.cells.map(h=>{const k=d(h.fill.TB);
return k?{tb:h,u6e:k}:void 0}).filter(__c.sb),g.length>0)){const h=__c.Zm(f);return g.map(({tb:k,u6e:l})=>{const n=m(h.get(k));return{fill:k.fill,u6e:l,container:n}})}return[]}).filter(__c.sb);b=e.map(({u6e:f})=>f.video?.video).filter(__c.sb);await a.dc.dPa(b);g1w(()=>e.forEach(f=>a.n1a(f.fill,f.u6e,f.container)))},n1w=function(a,b,{doctype:c,eb:d}){if(b.type==="fixed"){const e=__c.An.snapshot(b),f={width:c.eQ[0].dimensions.width,height:c.eQ[0].dimensions.height,units:r1w(c.eQ[0].dimensions.units)};
a=__c.NOb(a.Wc.vyb(a.r2j),a.session.document.dimensions,{width:1,height:1,units:4},f,e,{Arh:{type:"reference",Ea:c.id,kE:1,hH:d?d:b.re?.hH}});__c.An.Bt(b,a)}else b.re={type:"reference",Ea:c.id,kE:1,hH:d?d:b.re?.hH}},s1w=function(a,b,c){if(a=a.gwn.get(b.pQc))return c=__c.$m(c,a,0,c.bleed).Nb(),{...__c.js,media:a.ref,yb:c}},t1w=function(a,b,c){if(b=a.Avi.get(b.pQc))return c=__c.$m(c,b,0,c.bleed).Nb(),{...__c.iXc,...(b.mimeType==="image/gif"?{gEa:2}:{}),video:b.id,id:a.r2j.kNa.generate(),yb:c}},p1w=
function(a){const b=new Map;a.elements.forEach(c=>{switch(c.type){case "chart":case "rect":case "shape":case "grid":case "line":case "table":case "sheet":case "embed":case "layout":case "controlled":break;case "text":const d=V0w(c.TB);d==null||b.has(d)||b.set(d,{text:c});break;case "group":c.pb.forEach(e=>{switch(e.type){case "chart":case "rect":case "shape":case "grid":case "line":case "table":case "sheet":case "embed":case "layout":case "controlled":break;case "group":__c.hbe("ActionPerformer::getTextByContentRole");
break;case "text":const f=V0w(e.TB);f==null||b.has(f)||b.set(f,{container:c,text:e});break;default:throw new u(e);}});break;default:throw new u(c);}});return b},j1w=__webpack_require__(31968).jsx;__webpack_require__(845212);var u1w=__webpack_require__(186901),g1w=u1w.h5,q1w=u1w.XI,v1w=u1w.z7;var d1w={eventType:"editor_design_resized",Oa(a){return __c.jf({document_id:a.ka,source:a.source,from_doctype_id:a.I0m,from_doctype_width:a.J0m,from_doctype_height:a.H0m,from_category_id:a.G0m,to_doctype_id:a.SJo,to_doctype_width:a.TJo,to_doctype_height:a.RJo,to_category_id:a.IJo,editing_context:a.Ca==null?void 0:__c.mf(a.Ca)})}};var r1w;
__c.Gqf=class{async wus(a,b){const c=await b1w(this,a,b);return d=>c(d,[])}async Hgb(a,b){if(this.qh&&(this.X||a.type!=="CREATE_DEVICE_VIDEO"&&a.type!=="UPLOAD_VIDEO")){if(a.type==="CREATE_DEVICE_VIDEO"){var c=a.K2h;__c.ra(c.startsWith("device_video_"))}else c=a.pQc,__c.ra(c.startsWith("upload_"));var d=await this.V.ug("get_blob",b,async()=>this.xZb().then(g=>g?.getBlob(c)));if(d){var e=d.blob,f=d.name;this.V.ug("delete_blob",b,async()=>this.xZb().then(g=>g?.Q4c(c)));switch(a.type){case "UPLOAD_MEDIA":if(e.type==="application/json"&&
f?.startsWith("local_media_info_")){const g=f?.replace("local_media_info_","").replace(".json","")||"image",h=await this.V.ug("fetch_media_with_local_media_info",b,()=>e1w({blob:e}));return this.V.ug("create_and_upload_media",b,k=>this.Upf({pQc:c,name:g,blob:h,span:k}))}return this.V.ug("create_and_upload_media",b,g=>this.Upf({pQc:c,name:f||"image",blob:e,span:g}));case "UPLOAD_VIDEO":return this.V.ug("create_and_upload_video",b,g=>h1w(this,{pQc:c,name:f||"video",blob:e,span:g}));case "CREATE_DEVICE_VIDEO":return this.V.ug("create_device_video",
b,g=>i1w(this,{K2h:a.K2h,blob:e,span:g}).catch(h=>{this.errorService.error(h,"Failed to create device video");throw h;}));default:throw new u(a);}}else this.Ga(({onClose:g})=>j1w(__c.ld,{onClose:g,title:M("JihyWw"),explanation:a.type==="UPLOAD_MEDIA"?M("8yCbDA"):M("kW8rUA"),button:{children:M("iDD1Nw")}}))}}async Upf({pQc:a,name:b,blob:c,span:d}){const e=await this.V.ug("create_media",d,()=>this.sc.Hgb(new __c.Vei({fileSize:c.size,body:new __c.Edd({QC:b,Bo:!0,Kt:!0})}))),f=e.id,g=e.user,h=e.brand,
k=e.type;var l=e.Qb;const n=l.version;l=l.kc;const p={id:f,version:n},q=URL.createObjectURL(c);try{const r=await this.V.ug("create_image",d,()=>__c.Ds(q)),t=r.width,v=r.height,w=[new __c.Djh({url:r.src,width:t,height:v,page:0,quality:10,rf:"",key:"",De:!1,Cn:!1,F2:void 0,hu:!1,JCa:void 0,mimeType:""})],x=__c.g8e({id:f,version:n,user:g,brand:h,kc:l,type:k,files:w});g1w(()=>__c.Aae(this.Qa,x));this.gwn.set(a,{ref:p,width:t,height:v})}catch(r){throw URL.revokeObjectURL(q),r;}this.V.ug("upload_media",
d,()=>this.uploadMedia(e,c,b).then(q1w(({media:r})=>{const t=r.Qb;r=__c.g8e({id:r.id,version:t.version,user:r.user,brand:r.brand,kc:t.kc,type:r.type,files:t.files});this.Qa.TWa(p,!1);return __c.ch(this.Qa,r)}),q1w(()=>{this.Qa.TWa(p,!0)})).finally(q1w(()=>{this.Qa.kTc.delete(__c.XCa(p));URL.revokeObjectURL(q)})))}async uploadMedia(a,b,c){const d=m(this.qh);await v1w(()=>!!d.$U);({HM:[a]}=await d.$U([{media:a,content:b,name:c,type:b.type}],"init_action","background"));return a}async getVideoInfo(a){if(a.type===
"image/gif")return a=await (new __c.Klj).handle(a),{url:a.img.src,width:a.width,height:a.height,duration:void 0,V9a:void 0,k0m:new Image};a=URL.createObjectURL(a);const b=await __c.x1c(a);await __c.Hlj(b);const c=await __c.Jlj(b).then(__c.Ilj).catch(()=>new Image);return{url:b.src,width:b.videoWidth,height:b.videoHeight,duration:b.duration,V9a:a,k0m:c}}async hbj(a,b,c){const d=m(this.qh);await v1w(()=>!!d.LHl);({mBa:[a]}=await d.LHl([{U9h:a,content:b,name:c,type:b.type}],"start_with_image","background"));
return a}yVi(){for(const c of this.session.document.pages)if(c.type!=="responsive"){a:{var a=this.Ai.xb(c);switch(a.type){case "fixed-page":var b=a.ia.elements.first();a=b&&a.Me(b);break a;case "concatenated-fixed-page":for(const d of a.ia.pages)if(b=d.elements.first()){a=a.xb(d).Me(b);break a}break;default:throw new u(a);}a=void 0}if(a){this.vg.Jl(a.container,a.ia);this.viewport.Uw(c);break}}}async sVl({Bd:a,actions:b}){const c=m(this.session.document.pages.toArray()[a-1]);switch(c.type){case "fixed":const d=
this.Ai.xb(c);await Promise.all(b.map(e=>o1w(this,d,e)));break;case "concatenated-fixed":b.forEach(e=>{switch(e.type){case "SET_TITLE":case "SET_BACKGROUND":case "APPLY_TEMPLATE":case "SET_TEXT":case "SET_FILLS":case "RESIZE_PAGE_TO_DIMENSIONS":throw Error("PageAction type not supported for ConcatenatedFixedPage");case "RESIZE_PAGE_TO_DOCTYPE":n1w(this,c,e);break;default:throw new u(e);}});break;case "responsive":b.forEach(e=>{switch(e.type){case "SET_TITLE":case "SET_BACKGROUND":case "APPLY_TEMPLATE":case "SET_TEXT":case "SET_FILLS":case "RESIZE_PAGE_TO_DIMENSIONS":throw Error(`${e.type} PageAction type not supported for ResponsivePage`);
case "RESIZE_PAGE_TO_DOCTYPE":n1w(this,c,e);break;default:throw new u(e);}});break;default:throw new u(c);}}lnh(a,{background:b}){const c=b.color,d=b.image,e=b.WNk,f=b.video;b=b.ZNk;const g=a.Hc.first();if(g){c==="transparent"?g.color=void 0:c&&(g.color=c);var h;d?h=__c.Wg.i_d(d):e!=null&&(h=s1w(this,e,{...__c.sg(4,a.dimensions||this.session.document.dimensions),bleed:this.Uh.aib(a)}));h&&g.image.set(h);var k;f?k=__c.Wg.X4c(f):b!=null&&(k=t1w(this,b,{...__c.sg(4,a.dimensions||this.session.document.dimensions),
bleed:this.Uh.aib(a)}));k&&g.video.set(k)}}Wbo(a,{dimensions:b}){b=__c.NOb(this.Wc.vyb(this.r2j),this.session.document.dimensions,{width:1,height:1,units:4},b,__c.An.snapshot(a));__c.An.Bt(a,b)}n1a(a,b,c){b!=null&&(b.image?a.image.set(__c.Wg.i_d(b.image)):b.WNk?a.image.set(s1w(this,b.WNk,c)):a.image.set(void 0),b.video?(a.video.set(__c.Wg.X4c(b.video)),a.dropTarget=!0):b.ZNk?(a.video.set(t1w(this,b.ZNk,c)),a.dropTarget=!0):a.video.set(void 0),a.color=b.color!=="transparent"?b.color:void 0)}constructor(a,
b,c,d,e,f,g,h,k,l,n,p,q,r,t,v,w,x,y,z,B,C,G,H,K){this.X=a;this.session=b;this.Ai=c;this.r2j=d;this.errorService=e;this.kd=f;this.Wc=g;this.ZDe=h;this.Ga=k;this.Qa=l;this.dc=n;this.vg=p;this.viewport=q;this.qh=r;this.w3e=t;this.Uh=v;this.sc=w;this.Cg=x;this.rba=y;this.vs=z;this.Jt=B;this.xZb=C;this.N=G;this.PIs=H;this.V=K;this.gwn=new Map;this.Avi=new Map}};r1w=a=>{switch(a){case 1:return 1;case 2:return 2;case 3:return 3;case 4:return 4;default:throw new u(a);}};
}).call(self, self._456c437108d2d2713799e19380be528d);}

}])
//# sourceMappingURL=sourcemaps/d628b585cd7b6f7b.js.map